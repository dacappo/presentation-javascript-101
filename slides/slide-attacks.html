<section>

  <!-- Chapter slide -->
  <section>
    <h3><blue>Injection Attacks</blue></h3>    <br>
    <h3><span class="fa-stack fa-lg">
      <i class="fa fa-square fa-stack-2x"></i>
      <i class="fa fa-flash fa-stack-1x fa-inverse" style="line-height: 2em"></i>
    </span></h3>
  </section>
  
  <!-- What's the problem -->
  <section>
    <h3>What's already <blue>known</blue>?</h3><br>
    <p>
      <span class="fragment">Login bypass for <strong>MongoDB</strong> on PHP and NodeJS <sup><small>[3]</small></sup></span><br><br>
      <span class="fragment">String concatenation is still an issue for <strong>JSON and script</strong> parameters <sup><small>[4]</small></sup></span><br><br>
      <span class="fragment">Escaping flaws of drivers e.g. <strong>Memcached</strong><br> Got fixed! <sup><small>[5]</small></sup></span>
    </p>
  </section>

  <!-- Attacks - MongoDB - NodeJS Login Bypass? -->
  <section>
    <h4><blue>MongoDB</blue> - Login Bypass <sup><small>[3]</small></sup></h4>
<pre class="fragment" data-fragment-index="1"><code class="javascript" data-trim data-noescape>
// NodeJS with Express.js
db.collection('users').find({
  "user": <span class="fragment highlight-current-blue" data-fragment-index="3">req.query.user</span>, 
  "password": <span class="fragment highlight-current-blue" data-fragment-index="3">req.query.password</span>
});
</code></pre>

<code class="fragment code" data-fragment-index="2">
<blue><i class="fa fa-check"></i></blue> GET /login?user=<span class="fragment highlight-current-blue" data-fragment-index="3">patrick</span>&password=<span class="fragment highlight-current-blue" data-fragment-index="3">1234</span> HTTP/1.1
</code><br>

<code class="fragment code" data-fragment-index="4">
<blue><i class="fa fa-flash"></i></blue> GET /login?user=<span class="fragment highlight-blue" data-fragment-index="5">patrick</span>&password<span class="fragment highlight-blue" data-fragment-index="5">[%24ne]=</span> HTTP/1.1
</code>

<pre class="fragment" data-fragment-index="6"><code class="javascript" data-trim data-noescape>
// NodeJS with <mark class="fragment" data-fragment-index="7">Express.js</mark>
db.collection('users').find({
  "user": <span class="fragment" data-fragment-index="8">"patrick"</span>, 
  "password": <span class="fragment" data-fragment-index="8">{"$ne": ""}</span>
});
</code></pre>

  </section>

  <!-- Attacks -  Query selector injection on all platforms -->
  <section>
    <h4><blue>MongoDB</blue> - Login Bypass</h4>
<pre class="fragment"><code class="php" data-trim data-noescape>
// PHP
$collection->find(array(
  'user' => $_GET['user'], 
  'password' => $_GET['password']
));
</code></pre>

<span class="caption fragment"><i class="fa fa-flash"></i> What's new?</span class="caption">

<pre class="fragment"><code class="ruby" data-trim data-noescape>
# Ruby on Rails
db['users'].find({
  :user => req.params['user'], 
  :password => req.params['password']
})
</code></pre>
<pre class="fragment"><code class="python" data-trim data-noescape>
# Python with Django
db.users.find({
  "user": request.GET['user'], 
  "password": request.GET['password']
})
</code></pre>
  </section>

  <!-- Attacks -  Query selector with POST-->
  <section>
    <h4><blue>MongoDB</blue> - Login Bypass</h4>

<span class="caption fragment">... also works for body parameters!</span class="caption">
<pre class="fragment"><code data-trim data-noescape>
POST /login HTTP/1.1
Host: example.org
Content-Type: application/json
Content-Length: 38

{'user': 'patrick', <mark class="fragment">'password': {'$gt': ''}</mark>}
</code></pre>

<pre class="fragment"><code data-trim data-noescape>
POST /login HTTP/1.1
Host: example.org
Content-Type: application/x-www-form-urlencoded
Content-Length: 29

user=Patrick&<mark class="fragment">password[%24ne]=</mark>
</code></pre>
  </section>

  <!-- Attacks - Redis - Parameter overwrite injection -->
  <section>
    <h4 ><blue>Redis</blue> - Parameter Overwrite Injection</h4>
    <span class="caption fragment" data-fragment-index="1">... just a key-value store - what's the worst that could happen?</span class="caption">
<pre class="fragment" data-fragment-index="2"><code class="javascript" data-trim data-noescape>
// NodeJS with Express.js
RedisClient.expireat(
  <span class="fragment highlight-blue" data-fragment-index="5">req.query.key</span>, 
  new Date("November 8, 2026 11:13:00").getTime()
);
</code></pre>

<code class="fragment code" data-fragment-index="3">
<blue><i class="fa fa-flash"></i></blue> GET /expire?key<span class="fragment highlight-blue" data-fragment-index="4">[]=foo</span>&<span class="fragment highlight-blue" data-fragment-index="4">key[]=1117542887</span></span> HTTP/1.1
</code>
<br><br>
<p class="fragment" data-fragment-index="6">Injected array overwrites all following parameters of <strong>each database function</strong>!</p>
<p class="fragment" data-fragment-index="7">Only NodeJS driver affected!</p>

  </section>

 

  <!-- ######################## Summary ######################## -->
  <section>
    <h4><blue>Attack</blue> Overview</h4><br>

   <small> <table>
      <tr>
        <th>Class</th>
        <th>Attack</th> 
        <th>Database</th>
      </tr>
      <tr class="">
        <td rowspan="2" class="fragment highlight-green">Object Structure Semantic</td> 
        <td>Query Selector Injection</td>
        <td>MongoDB</td>
      </tr>
      <tr class="" style="border-bottom: #333 solid 1px">
        <td>Find Selector Injection</td>
        <td>CouchDB</td>
      </tr>
      <tr class="">
        <td rowspan="4" class="fragment highlight-green">Diverging Parameter Handling</td> 
        <td>Expanding Array Injection</td>
        <td>MongoDB</td>
      </tr>
      <tr class="">
        <td>Parameter Overwrite Injection</td>
        <td>Redis</td>
      </tr>
      <tr class="">
        <td>Array Value Injection</td>
        <td>CouchDB</td>
      </tr>
      <tr class="" style="border-bottom: #333 solid 1px">
        <td>Array Key Injection</td>
        <td>Memcached</td>
      </tr>
      <tr class="">
        <td rowspan="2">Shared Scope for Data</td> 
        <td>Special Key Injection</td>
        <td>CouchDB</td>
      </tr>
      <tr class="" style="border-bottom: #333 solid 1px">
        <td>Data Import Injection</td>
        <td>CouchDB</td>
      </tr>
      <tr class="">
        <td>Error-prone String Escaping</td>
        <td>URL Traversal Injection</td>
        <td>CouchDB</td>
      </tr>
    </table><br><br>

    <p class="fragment"><em>NoSQL injections are prevalent across all investigated platforms!</em></p></small>
  </section>
  

  <!-- ######################## Summary ######################## -->
  <section>
    <h3><blue>Practical</blue> Example</h3>
    <span class="caption fragment" data-fragment-index="0">Previous examples are crafted cases.<br> Does NoSQL injection exist in real applications?</span class="caption"><br><br>

    <p class="fragment" data-fragment-index="2"><strong>HashBrown</strong> CMS</p>
    <a class="caption fragment" data-fragment-index="2" target="blank" href="http://hashbrown.rocks/">http://hashbrown.rocks/</a>

  </section>
</section>